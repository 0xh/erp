<?php

namespace App\Http\Controllers;

use App\Http\Controllers\Controller;
use PHPMentors\Workflower\Definition\Bpmn2Reader;
use PHPMentors\Workflower\Workflow\Event\StartEvent;
use PHPMentors\Workflower\Workflow\Participant\ParticipantInterface;
use PHPMentors\Workflower\Workflow\Resource\ResourceInterface;
use PHPMentors\Workflower\Workflow\Workflow;

class TestController extends Controller
{
    public $test;
    protected $workflowRepository;

    public function __construct()
    {
        $this->workflowRepository = new WorkflowRepository();
    }

    public function test()
    {
        $kiyoshiApp = new testWorkflow();
        $output = $kiyoshiApp->run();
//        $output = $kiyoshiApp->a3dm();

        echo implode(' ', $output)."\n";

    }

}

class testWorkflow
{
    public function a3dm()
    {
//        $definitionPath =__DIR__.'/bpmn/kiyoshi.bpmn';
        $definitionPath =__DIR__.'/bpmn/Approve3DModel.bpmn';
        $reader = new Bpmn2Reader();
        $workflow = $reader->read($definitionPath);

        $kiyoshi = new KiyoshiHikawa();
        $fun = new Fun();

        $records = [];
        $workflow->setProcessData(['record' => implode(',', $records), 'approve' => 1]);
        $workflow->start(new StartEvent('Start', $workflow->getRole('Modeler')));
        while ($workflow->isActive()) {
            ddd(unserialize($workflow->serialize()));
//$dd=$workflow->getCurrentFlowObject();
            $participant = $workflow->getCurrentFlowObject()->getRole()->getId() == 'kiyoshi_hikawa' ? $kiyoshi : $fun;
            if (false !== strpos($workflow->getCurrentFlowObject()->getId(), 'say_')) {
                $record = str_replace('say_', '', $workflow->getCurrentFlowObject()->getId());
                $records[] = $record;
                var_dump($record);
            }
            $workflow->setProcessData(['record' => implode(',', $records), 'random' => rand()]);
            $workflow->allocateWorkItem($workflow->getCurrentFlowObject(), $participant);
            $workflow->startWorkItem($workflow->getCurrentFlowObject(), $participant);
            $workflow->completeWorkItem($workflow->getCurrentFlowObject(), $participant);
        }

        return $records;
    }
    public function run()
    {
        $definitionPath =__DIR__.'/bpmn/kiyoshi.bpmn';
        $reader = new Bpmn2Reader();
        $workflow = $reader->read($definitionPath);

        $kiyoshi = new KiyoshiHikawa();
        $fun = new Fun();

        $records = [];
//        $tess = 'YTo3OntzOjQ6Im5hbWUiO047czoyNjoiY29ubmVjdGluZ09iamVjdENvbGxlY3Rpb24iO0M6NjU6IlBIUE1lbnRvcnNcV29ya2Zsb3dlclxXb3JrZmxvd1xFbGVtZW50XENvbm5lY3RpbmdPYmplY3RDb2xsZWN0aW9uIjo0NzUxOnthOjE6e3M6MTc6ImNvbm5lY3RpbmdPYmplY3RzIjthOjg6e3M6MTA6ImZsb3dfc3RhcnQiO0M6NTQ6IlBIUE1lbnRvcnNcV29ya2Zsb3dlclxXb3JrZmxvd1xDb25uZWN0aW9uXFNlcXVlbmNlRmxvdyI6NDkwOnthOjU6e3M6MjoiaWQiO3M6MTA6ImZsb3dfc3RhcnQiO3M6NDoibmFtZSI7TjtzOjY6InNvdXJjZSI7Qzo0NzoiUEhQTWVudG9yc1xXb3JrZmxvd2VyXFdvcmtmbG93XEV2ZW50XFN0YXJ0RXZlbnQiOjE2MTp7YTozOntzOjI6ImlkIjtzOjU6InN0YXJ0IjtzOjQ6Im5hbWUiO047czo0OiJyb2xlIjtDOjQ3OiJQSFBNZW50b3JzXFdvcmtmbG93ZXJcV29ya2Zsb3dcUGFydGljaXBhbnRcUm9sZSI6NTA6e2E6Mjp7czoyOiJpZCI7czoxNDoia2l5b3NoaV9oaWthd2EiO3M6NDoibmFtZSI7Tjt9fX19czoxMToiZGVzdGluYXRpb24iO0M6NTU6IlBIUE1lbnRvcnNcV29ya2Zsb3dlclxXb3JrZmxvd1xHYXRld2F5XEV4Y2x1c2l2ZUdhdGV3YXkiOjEwMzp7YTo0OntzOjI6ImlkIjtzOjIyOiJyYW5kb21fenVuZG9rb19nYXRld2F5IjtzOjQ6Im5hbWUiO047czo0OiJyb2xlIjtyOjE0O3M6MTk6ImRlZmF1bHRTZXF1ZW5jZUZsb3ciO047fX1zOjk6ImNvbmRpdGlvbiI7Tjt9fXM6MjY6ImZsb3dfYWZ0ZXJfa2l5b3NoaV9nYXRld2F5IjtDOjU0OiJQSFBNZW50b3JzXFdvcmtmbG93ZXJcV29ya2Zsb3dcQ29ubmVjdGlvblxTZXF1ZW5jZUZsb3ciOjMxNDp7YTo1OntzOjI6ImlkIjtzOjI2OiJmbG93X2FmdGVyX2tpeW9zaGlfZ2F0ZXdheSI7czo0OiJuYW1lIjtOO3M6Njoic291cmNlIjtDOjU1OiJQSFBNZW50b3JzXFdvcmtmbG93ZXJcV29ya2Zsb3dcR2F0ZXdheVxFeGNsdXNpdmVHYXRld2F5IjoxMjg6e2E6NDp7czoyOiJpZCI7czoxNToia2l5b3NoaV9nYXRld2F5IjtzOjQ6Im5hbWUiO047czo0OiJyb2xlIjtyOjE0O3M6MTk6ImRlZmF1bHRTZXF1ZW5jZUZsb3ciO3M6MjY6ImZsb3dfYWZ0ZXJfa2l5b3NoaV9nYXRld2F5Ijt9fXM6MTE6ImRlc3RpbmF0aW9uIjtyOjE4O3M6OToiY29uZGl0aW9uIjtOO319czoxNjoiZmxvd19iZWZvcmVfZG9rbyI7Qzo1NDoiUEhQTWVudG9yc1xXb3JrZmxvd2VyXFdvcmtmbG93XENvbm5lY3Rpb25cU2VxdWVuY2VGbG93Ijo3ODA6e2E6NTp7czoyOiJpZCI7czoxNjoiZmxvd19iZWZvcmVfZG9rbyI7czo0OiJuYW1lIjtOO3M6Njoic291cmNlIjtyOjE4O3M6MTE6ImRlc3RpbmF0aW9uIjtDOjQ0OiJQSFBNZW50b3JzXFdvcmtmbG93ZXJcV29ya2Zsb3dcQWN0aXZpdHlcVGFzayI6NTE0OnthOjU6e3M6MjoiaWQiO3M6ODoic2F5X2Rva28iO3M6NDoicm9sZSI7cjoxNDtzOjQ6Im5hbWUiO3M6NDoiZG9rbyI7czo5OiJ3b3JrSXRlbXMiO2E6MTp7aTowO0M6NDg6IlBIUE1lbnRvcnNcV29ya2Zsb3dlclxXb3JrZmxvd1xBY3Rpdml0eVxXb3JrSXRlbSI6MzA2OnthOjg6e3M6MTI6ImN1cnJlbnRTdGF0ZSI7czo3OiJjcmVhdGVkIjtzOjExOiJwYXJ0aWNpcGFudCI7TjtzOjEyOiJjcmVhdGlvbkRhdGUiO086ODoiRGF0ZVRpbWUiOjM6e3M6NDoiZGF0ZSI7czoyNjoiMjAxOC0wNS0yNSAxNzozNjoxMy4wMzg0MDMiO3M6MTM6InRpbWV6b25lX3R5cGUiO2k6MztzOjg6InRpbWV6b25lIjtzOjEzOiJBc2lhL1NoYW5naGFpIjt9czoxNDoiYWxsb2NhdGlvbkRhdGUiO047czo5OiJzdGFydERhdGUiO047czo3OiJlbmREYXRlIjtOO3M6MTQ6ImVuZFBhcnRpY2lwYW50IjtOO3M6OToiZW5kUmVzdWx0IjtOO319fXM6MjE6ImRlZmF1bHRTZXF1ZW5jZUZsb3dJZCI7czoxNToiZmxvd19hZnRlcl9kb2tvIjt9fXM6OToiY29uZGl0aW9uIjtPOjQ3OiJTeW1mb255XENvbXBvbmVudFxFeHByZXNzaW9uTGFuZ3VhZ2VcRXhwcmVzc2lvbiI6MTp7czoxMzoiACoAZXhwcmVzc2lvbiI7czoxNToicmFuZG9tICUgMiA9PSAxIjt9fX1zOjE1OiJmbG93X2JlZm9yZV96dW4iO0M6NTQ6IlBIUE1lbnRvcnNcV29ya2Zsb3dlclxXb3JrZmxvd1xDb25uZWN0aW9uXFNlcXVlbmNlRmxvdyI6MTQ1NDp7YTo1OntzOjI6ImlkIjtzOjE1OiJmbG93X2JlZm9yZV96dW4iO3M6NDoibmFtZSI7TjtzOjY6InNvdXJjZSI7cjoxODtzOjExOiJkZXN0aW5hdGlvbiI7Qzo0NDoiUEhQTWVudG9yc1xXb3JrZmxvd2VyXFdvcmtmbG93XEFjdGl2aXR5XFRhc2siOjExODg6e2E6NTp7czoyOiJpZCI7czo3OiJzYXlfenVuIjtzOjQ6InJvbGUiO3I6MTQ7czo0OiJuYW1lIjtzOjM6Inp1biI7czo5OiJ3b3JrSXRlbXMiO2E6MTp7aTowO0M6NDg6IlBIUE1lbnRvcnNcV29ya2Zsb3dlclxXb3JrZmxvd1xBY3Rpdml0eVxXb3JrSXRlbSI6OTgzOnthOjg6e3M6MTI6ImN1cnJlbnRTdGF0ZSI7czo1OiJlbmRlZCI7czoxMToicGFydGljaXBhbnQiO0M6NjA6IlBIUE1lbnRvcnNcV29ya2Zsb3dlclxXb3JrZmxvd1xQYXJ0aWNpcGFudFxMb2dnZWRQYXJ0aWNpcGFudCI6NzY6e2E6Mjp7czoyOiJpZCI7czoxNzoibXJfa2l5b3NoaV9oaWthd2EiO3M6NDoibmFtZSI7czoxNzoibXJfa2l5b3NoaV9oaWthd2EiO319czoxMjoiY3JlYXRpb25EYXRlIjtPOjg6IkRhdGVUaW1lIjozOntzOjQ6ImRhdGUiO3M6MjY6IjIwMTgtMDUtMjUgMTc6MzY6MTMuMDMwNDAzIjtzOjEzOiJ0aW1lem9uZV90eXBlIjtpOjM7czo4OiJ0aW1lem9uZSI7czoxMzoiQXNpYS9TaGFuZ2hhaSI7fXM6MTQ6ImFsbG9jYXRpb25EYXRlIjtPOjg6IkRhdGVUaW1lIjozOntzOjQ6ImRhdGUiO3M6MjY6IjIwMTgtMDUtMjUgMTc6MzY6MTMuMDM3NDAzIjtzOjEzOiJ0aW1lem9uZV90eXBlIjtpOjM7czo4OiJ0aW1lem9uZSI7czoxMzoiQXNpYS9TaGFuZ2hhaSI7fXM6OToic3RhcnREYXRlIjtPOjg6IkRhdGVUaW1lIjozOntzOjQ6ImRhdGUiO3M6MjY6IjIwMTgtMDUtMjUgMTc6MzY6MTMuMDM3NDAzIjtzOjEzOiJ0aW1lem9uZV90eXBlIjtpOjM7czo4OiJ0aW1lem9uZSI7czoxMzoiQXNpYS9TaGFuZ2hhaSI7fXM6NzoiZW5kRGF0ZSI7Tzo4OiJEYXRlVGltZSI6Mzp7czo0OiJkYXRlIjtzOjI2OiIyMDE4LTA1LTI1IDE3OjM2OjEzLjAzNzQwMyI7czoxMzoidGltZXpvbmVfdHlwZSI7aTozO3M6ODoidGltZXpvbmUiO3M6MTM6IkFzaWEvU2hhbmdoYWkiO31zOjE0OiJlbmRQYXJ0aWNpcGFudCI7Qzo2MDoiUEhQTWVudG9yc1xXb3JrZmxvd2VyXFdvcmtmbG93XFBhcnRpY2lwYW50XExvZ2dlZFBhcnRpY2lwYW50Ijo3Njp7YToyOntzOjI6ImlkIjtzOjE3OiJtcl9raXlvc2hpX2hpa2F3YSI7czo0OiJuYW1lIjtzOjE3OiJtcl9raXlvc2hpX2hpa2F3YSI7fX1zOjk6ImVuZFJlc3VsdCI7czoxMDoiY29tcGxldGlvbiI7fX19czoyMToiZGVmYXVsdFNlcXVlbmNlRmxvd0lkIjtzOjE0OiJmbG93X2FmdGVyX3p1biI7fX1zOjk6ImNvbmRpdGlvbiI7Tzo0NzoiU3ltZm9ueVxDb21wb25lbnRcRXhwcmVzc2lvbkxhbmd1YWdlXEV4cHJlc3Npb24iOjE6e3M6MTM6IgAqAGV4cHJlc3Npb24iO3M6MTU6InJhbmRvbSAlIDIgPT0gMCI7fX19czoxNToiZmxvd19hZnRlcl9kb2tvIjtDOjU0OiJQSFBNZW50b3JzXFdvcmtmbG93ZXJcV29ya2Zsb3dcQ29ubmVjdGlvblxTZXF1ZW5jZUZsb3ciOjExMTp7YTo1OntzOjI6ImlkIjtzOjE1OiJmbG93X2FmdGVyX2Rva28iO3M6NDoibmFtZSI7TjtzOjY6InNvdXJjZSI7cjo0MjtzOjExOiJkZXN0aW5hdGlvbiI7cjoyOTtzOjk6ImNvbmRpdGlvbiI7Tjt9fXM6MTk6ImZsb3dfYmVmb3JlX2tpeW9zaGkiO0M6NTQ6IlBIUE1lbnRvcnNcV29ya2Zsb3dlclxXb3JrZmxvd1xDb25uZWN0aW9uXFNlcXVlbmNlRmxvdyI6NTA0OnthOjU6e3M6MjoiaWQiO3M6MTk6ImZsb3dfYmVmb3JlX2tpeW9zaGkiO3M6NDoibmFtZSI7TjtzOjY6InNvdXJjZSI7cjoyOTtzOjExOiJkZXN0aW5hdGlvbiI7Qzo0NDoiUEhQTWVudG9yc1xXb3JrZmxvd2VyXFdvcmtmbG93XEFjdGl2aXR5XFRhc2siOjIyMTp7YTo1OntzOjI6ImlkIjtzOjExOiJzYXlfa2l5b3NoaSI7czo0OiJyb2xlIjtDOjQ3OiJQSFBNZW50b3JzXFdvcmtmbG93ZXJcV29ya2Zsb3dcUGFydGljaXBhbnRcUm9sZSI6Mzg6e2E6Mjp7czoyOiJpZCI7czozOiJmdW4iO3M6NDoibmFtZSI7Tjt9fXM6NDoibmFtZSI7czo3OiJraXlvc2hpIjtzOjk6IndvcmtJdGVtcyI7YTowOnt9czoyMToiZGVmYXVsdFNlcXVlbmNlRmxvd0lkIjtOO319czo5OiJjb25kaXRpb24iO086NDc6IlN5bWZvbnlcQ29tcG9uZW50XEV4cHJlc3Npb25MYW5ndWFnZVxFeHByZXNzaW9uIjoxOntzOjEzOiIAKgBleHByZXNzaW9uIjtzOjI5OiJyZWNvcmQgbWF0Y2hlcyAiL3p1blwsZG9rbyQvIiI7fX19czo4OiJmbG93X2VuZCI7Qzo1NDoiUEhQTWVudG9yc1xXb3JrZmxvd2VyXFdvcmtmbG93XENvbm5lY3Rpb25cU2VxdWVuY2VGbG93IjoyMjA6e2E6NTp7czoyOiJpZCI7czo4OiJmbG93X2VuZCI7czo0OiJuYW1lIjtOO3M6Njoic291cmNlIjtyOjExODtzOjExOiJkZXN0aW5hdGlvbiI7Qzo0NToiUEhQTWVudG9yc1xXb3JrZmxvd2VyXFdvcmtmbG93XEV2ZW50XEVuZEV2ZW50Ijo2Mzp7YTozOntzOjI6ImlkIjtzOjM6ImVuZCI7czo0OiJuYW1lIjtzOjM6ImVuZCI7czo0OiJyb2xlIjtyOjEyMTt9fXM6OToiY29uZGl0aW9uIjtOO319czoxNDoiZmxvd19hZnRlcl96dW4iO0M6NTQ6IlBIUE1lbnRvcnNcV29ya2Zsb3dlclxXb3JrZmxvd1xDb25uZWN0aW9uXFNlcXVlbmNlRmxvdyI6MTEwOnthOjU6e3M6MjoiaWQiO3M6MTQ6ImZsb3dfYWZ0ZXJfenVuIjtzOjQ6Im5hbWUiO047czo2OiJzb3VyY2UiO3I6Njk7czoxMToiZGVzdGluYXRpb24iO3I6MTg7czo5OiJjb25kaXRpb24iO047fX19fX1zOjIwOiJmbG93T2JqZWN0Q29sbGVjdGlvbiI7Qzo1OToiUEhQTWVudG9yc1xXb3JrZmxvd2VyXFdvcmtmbG93XEVsZW1lbnRcRmxvd09iamVjdENvbGxlY3Rpb24iOjE5MTp7YToxOntzOjExOiJmbG93T2JqZWN0cyI7YTo3OntzOjU6InN0YXJ0IjtyOjEwO3M6MzoiZW5kIjtyOjEzNTtzOjg6InNheV9kb2tvIjtyOjQyO3M6Nzoic2F5X3p1biI7cjo2OTtzOjExOiJzYXlfa2l5b3NoaSI7cjoxMTg7czoyMjoicmFuZG9tX3p1bmRva29fZ2F0ZXdheSI7cjoxODtzOjE1OiJraXlvc2hpX2dhdGV3YXkiO3I6Mjk7fX19czoxNDoicm9sZUNvbGxlY3Rpb24iO0M6NTc6IlBIUE1lbnRvcnNcV29ya2Zsb3dlclxXb3JrZmxvd1xQYXJ0aWNpcGFudFxSb2xlQ29sbGVjdGlvbiI6Njc6e2E6MTp7czo1OiJyb2xlcyI7YToyOntzOjE0OiJraXlvc2hpX2hpa2F3YSI7cjoxNDtzOjM6ImZ1biI7cjoxMjE7fX19czo5OiJzdGFydERhdGUiO086ODoiRGF0ZVRpbWUiOjM6e3M6NDoiZGF0ZSI7czoyNjoiMjAxOC0wNS0yNSAxNzozNjoxMy4wMjQ0MDMiO3M6MTM6InRpbWV6b25lX3R5cGUiO2k6MztzOjg6InRpbWV6b25lIjtzOjEzOiJBc2lhL1NoYW5naGFpIjt9czo3OiJlbmREYXRlIjtOO3M6MTI6InN0YXRlTWFjaGluZSI7QzozOToiU3RhZ2VoYW5kXEZTTVxTdGF0ZU1hY2hpbmVcU3RhdGVNYWNoaW5lIjo3MjYzOnthOjY6e3M6MTU6InN0YXRlQ29sbGVjdGlvbiI7TzozNToiU3RhZ2VoYW5kXEZTTVxTdGF0ZVxTdGF0ZUNvbGxlY3Rpb24iOjE6e3M6NDM6IgBTdGFnZWhhbmRcRlNNXFN0YXRlXFN0YXRlQ29sbGVjdGlvbgBzdGF0ZXMiO2E6MTA6e3M6MTE6Il9fSU5JVElBTF9fIjtDOjMyOiJTdGFnZWhhbmRcRlNNXFN0YXRlXEluaXRpYWxTdGF0ZSI6MzcyOnthOjU6e3M6Nzoic3RhdGVJRCI7czoxMToiX19JTklUSUFMX18iO3M6MTU6InRyYW5zaXRpb25FdmVudCI7TjtzOjc6InN0YXRlSWQiO3M6MTE6Il9fSU5JVElBTF9fIjtzOjY6ImV2ZW50cyI7YTowOnt9czoxNToiZXZlbnRDb2xsZWN0aW9uIjtPOjM1OiJTdGFnZWhhbmRcRlNNXEV2ZW50XEV2ZW50Q29sbGVjdGlvbiI6MTp7czo0MzoiAFN0YWdlaGFuZFxGU01cRXZlbnRcRXZlbnRDb2xsZWN0aW9uAGV2ZW50cyI7YToxOntzOjk6Il9fU1RBUlRfXyI7QzozNToiU3RhZ2VoYW5kXEZTTVxFdmVudFxUcmFuc2l0aW9uRXZlbnQiOjY1OnthOjM6e3M6NzoiZXZlbnRJZCI7czo5OiJfX1NUQVJUX18iO3M6NjoiYWN0aW9uIjtOO3M6NToiZ3VhcmQiO047fX19fX19czo5OiJfX0ZJTkFMX18iO086MzA6IlN0YWdlaGFuZFxGU01cU3RhdGVcRmluYWxTdGF0ZSI6MDp7fXM6OToiX19TVEFSVF9fIjtDOjI1OiJTdGFnZWhhbmRcRlNNXFN0YXRlXFN0YXRlIjozMTk6e2E6NDp7czo3OiJzdGF0ZUlEIjtOO3M6Nzoic3RhdGVJZCI7czo5OiJfX1NUQVJUX18iO3M6NjoiZXZlbnRzIjthOjA6e31zOjE1OiJldmVudENvbGxlY3Rpb24iO086MzU6IlN0YWdlaGFuZFxGU01cRXZlbnRcRXZlbnRDb2xsZWN0aW9uIjoxOntzOjQzOiIAU3RhZ2VoYW5kXEZTTVxFdmVudFxFdmVudENvbGxlY3Rpb24AZXZlbnRzIjthOjE6e3M6NToic3RhcnQiO0M6MzU6IlN0YWdlaGFuZFxGU01cRXZlbnRcVHJhbnNpdGlvbkV2ZW50Ijo2MTp7YTozOntzOjc6ImV2ZW50SWQiO3M6NToic3RhcnQiO3M6NjoiYWN0aW9uIjtOO3M6NToiZ3VhcmQiO047fX19fX19czo1OiJzdGFydCI7QzoyNToiU3RhZ2VoYW5kXEZTTVxTdGF0ZVxTdGF0ZSI6MzUxOnthOjQ6e3M6Nzoic3RhdGVJRCI7TjtzOjc6InN0YXRlSWQiO3M6NToic3RhcnQiO3M6NjoiZXZlbnRzIjthOjA6e31zOjE1OiJldmVudENvbGxlY3Rpb24iO086MzU6IlN0YWdlaGFuZFxGU01cRXZlbnRcRXZlbnRDb2xsZWN0aW9uIjoxOntzOjQzOiIAU3RhZ2VoYW5kXEZTTVxFdmVudFxFdmVudENvbGxlY3Rpb24AZXZlbnRzIjthOjE6e3M6MjI6InJhbmRvbV96dW5kb2tvX2dhdGV3YXkiO0M6MzU6IlN0YWdlaGFuZFxGU01cRXZlbnRcVHJhbnNpdGlvbkV2ZW50Ijo3OTp7YTozOntzOjc6ImV2ZW50SWQiO3M6MjI6InJhbmRvbV96dW5kb2tvX2dhdGV3YXkiO3M6NjoiYWN0aW9uIjtOO3M6NToiZ3VhcmQiO047fX19fX19czozOiJlbmQiO0M6MjU6IlN0YWdlaGFuZFxGU01cU3RhdGVcU3RhdGUiOjMwOTp7YTo0OntzOjc6InN0YXRlSUQiO047czo3OiJzdGF0ZUlkIjtzOjM6ImVuZCI7czo2OiJldmVudHMiO2E6MDp7fXM6MTU6ImV2ZW50Q29sbGVjdGlvbiI7TzozNToiU3RhZ2VoYW5kXEZTTVxFdmVudFxFdmVudENvbGxlY3Rpb24iOjE6e3M6NDM6IgBTdGFnZWhhbmRcRlNNXEV2ZW50XEV2ZW50Q29sbGVjdGlvbgBldmVudHMiO2E6MTp7czozOiJlbmQiO0M6MzU6IlN0YWdlaGFuZFxGU01cRXZlbnRcVHJhbnNpdGlvbkV2ZW50Ijo1OTp7YTozOntzOjc6ImV2ZW50SWQiO3M6MzoiZW5kIjtzOjY6ImFjdGlvbiI7TjtzOjU6Imd1YXJkIjtOO319fX19fXM6ODoic2F5X2Rva28iO0M6MjU6IlN0YWdlaGFuZFxGU01cU3RhdGVcU3RhdGUiOjM0MDp7YTo0OntzOjc6InN0YXRlSUQiO047czo3OiJzdGF0ZUlkIjtzOjg6InNheV9kb2tvIjtzOjY6ImV2ZW50cyI7YTowOnt9czoxNToiZXZlbnRDb2xsZWN0aW9uIjtPOjM1OiJTdGFnZWhhbmRcRlNNXEV2ZW50XEV2ZW50Q29sbGVjdGlvbiI6MTp7czo0MzoiAFN0YWdlaGFuZFxGU01cRXZlbnRcRXZlbnRDb2xsZWN0aW9uAGV2ZW50cyI7YToxOntzOjE1OiJraXlvc2hpX2dhdGV3YXkiO0M6MzU6IlN0YWdlaGFuZFxGU01cRXZlbnRcVHJhbnNpdGlvbkV2ZW50Ijo3Mjp7YTozOntzOjc6ImV2ZW50SWQiO3M6MTU6ImtpeW9zaGlfZ2F0ZXdheSI7czo2OiJhY3Rpb24iO047czo1OiJndWFyZCI7Tjt9fX19fX1zOjc6InNheV96dW4iO0M6MjU6IlN0YWdlaGFuZFxGU01cU3RhdGVcU3RhdGUiOjM1Mzp7YTo0OntzOjc6InN0YXRlSUQiO047czo3OiJzdGF0ZUlkIjtzOjc6InNheV96dW4iO3M6NjoiZXZlbnRzIjthOjA6e31zOjE1OiJldmVudENvbGxlY3Rpb24iO086MzU6IlN0YWdlaGFuZFxGU01cRXZlbnRcRXZlbnRDb2xsZWN0aW9uIjoxOntzOjQzOiIAU3RhZ2VoYW5kXEZTTVxFdmVudFxFdmVudENvbGxlY3Rpb24AZXZlbnRzIjthOjE6e3M6MjI6InJhbmRvbV96dW5kb2tvX2dhdGV3YXkiO0M6MzU6IlN0YWdlaGFuZFxGU01cRXZlbnRcVHJhbnNpdGlvbkV2ZW50Ijo3OTp7YTozOntzOjc6ImV2ZW50SWQiO3M6MjI6InJhbmRvbV96dW5kb2tvX2dhdGV3YXkiO3M6NjoiYWN0aW9uIjtOO3M6NToiZ3VhcmQiO047fX19fX19czoxMToic2F5X2tpeW9zaGkiO0M6MjU6IlN0YWdlaGFuZFxGU01cU3RhdGVcU3RhdGUiOjMxODp7YTo0OntzOjc6InN0YXRlSUQiO047czo3OiJzdGF0ZUlkIjtzOjExOiJzYXlfa2l5b3NoaSI7czo2OiJldmVudHMiO2E6MDp7fXM6MTU6ImV2ZW50Q29sbGVjdGlvbiI7TzozNToiU3RhZ2VoYW5kXEZTTVxFdmVudFxFdmVudENvbGxlY3Rpb24iOjE6e3M6NDM6IgBTdGFnZWhhbmRcRlNNXEV2ZW50XEV2ZW50Q29sbGVjdGlvbgBldmVudHMiO2E6MTp7czozOiJlbmQiO0M6MzU6IlN0YWdlaGFuZFxGU01cRXZlbnRcVHJhbnNpdGlvbkV2ZW50Ijo1OTp7YTozOntzOjc6ImV2ZW50SWQiO3M6MzoiZW5kIjtzOjY6ImFjdGlvbiI7TjtzOjU6Imd1YXJkIjtOO319fX19fXM6MjI6InJhbmRvbV96dW5kb2tvX2dhdGV3YXkiO0M6MjU6IlN0YWdlaGFuZFxGU01cU3RhdGVcU3RhdGUiOjQ2NDp7YTo0OntzOjc6InN0YXRlSUQiO047czo3OiJzdGF0ZUlkIjtzOjIyOiJyYW5kb21fenVuZG9rb19nYXRld2F5IjtzOjY6ImV2ZW50cyI7YTowOnt9czoxNToiZXZlbnRDb2xsZWN0aW9uIjtPOjM1OiJTdGFnZWhhbmRcRlNNXEV2ZW50XEV2ZW50Q29sbGVjdGlvbiI6MTp7czo0MzoiAFN0YWdlaGFuZFxGU01cRXZlbnRcRXZlbnRDb2xsZWN0aW9uAGV2ZW50cyI7YToyOntzOjg6InNheV9kb2tvIjtDOjM1OiJTdGFnZWhhbmRcRlNNXEV2ZW50XFRyYW5zaXRpb25FdmVudCI6NjQ6e2E6Mzp7czo3OiJldmVudElkIjtzOjg6InNheV9kb2tvIjtzOjY6ImFjdGlvbiI7TjtzOjU6Imd1YXJkIjtOO319czo3OiJzYXlfenVuIjtDOjM1OiJTdGFnZWhhbmRcRlNNXEV2ZW50XFRyYW5zaXRpb25FdmVudCI6NjM6e2E6Mzp7czo3OiJldmVudElkIjtzOjc6InNheV96dW4iO3M6NjoiYWN0aW9uIjtOO3M6NToiZ3VhcmQiO047fX19fX19czoxNToia2l5b3NoaV9nYXRld2F5IjtDOjI1OiJTdGFnZWhhbmRcRlNNXFN0YXRlXFN0YXRlIjo0OTc6e2E6NDp7czo3OiJzdGF0ZUlEIjtOO3M6Nzoic3RhdGVJZCI7czoxNToia2l5b3NoaV9nYXRld2F5IjtzOjY6ImV2ZW50cyI7YTowOnt9czoxNToiZXZlbnRDb2xsZWN0aW9uIjtPOjM1OiJTdGFnZWhhbmRcRlNNXEV2ZW50XEV2ZW50Q29sbGVjdGlvbiI6MTp7czo0MzoiAFN0YWdlaGFuZFxGU01cRXZlbnRcRXZlbnRDb2xsZWN0aW9uAGV2ZW50cyI7YToyOntzOjIyOiJyYW5kb21fenVuZG9rb19nYXRld2F5IjtDOjM1OiJTdGFnZWhhbmRcRlNNXEV2ZW50XFRyYW5zaXRpb25FdmVudCI6Nzk6e2E6Mzp7czo3OiJldmVudElkIjtzOjIyOiJyYW5kb21fenVuZG9rb19nYXRld2F5IjtzOjY6ImFjdGlvbiI7TjtzOjU6Imd1YXJkIjtOO319czoxMToic2F5X2tpeW9zaGkiO0M6MzU6IlN0YWdlaGFuZFxGU01cRXZlbnRcVHJhbnNpdGlvbkV2ZW50Ijo2ODp7YTozOntzOjc6ImV2ZW50SWQiO3M6MTE6InNheV9raXlvc2hpIjtzOjY6ImFjdGlvbiI7TjtzOjU6Imd1YXJkIjtOO319fX19fX19czoxNDoic3RhdGVNYWNoaW5lSWQiO3M6MTY6ImtpeW9zaGlfd29ya2Zsb3ciO3M6MTA6ImV2ZW50UXVldWUiO2E6MDp7fXM6MTM6InRyYW5zaXRpb25Mb2ciO2E6Njp7aTowO086NDA6IlN0YWdlaGFuZFxGU01cU3RhdGVNYWNoaW5lXFRyYW5zaXRpb25Mb2ciOjQ6e3M6NDc6IgBTdGFnZWhhbmRcRlNNXFN0YXRlTWFjaGluZVxUcmFuc2l0aW9uTG9nAGV2ZW50IjtyOjE4MDtzOjUxOiIAU3RhZ2VoYW5kXEZTTVxTdGF0ZU1hY2hpbmVcVHJhbnNpdGlvbkxvZwBmcm9tU3RhdGUiO3I6MTcyO3M6NDk6IgBTdGFnZWhhbmRcRlNNXFN0YXRlTWFjaGluZVxUcmFuc2l0aW9uTG9nAHRvU3RhdGUiO3I6MTg2O3M6NTY6IgBTdGFnZWhhbmRcRlNNXFN0YXRlTWFjaGluZVxUcmFuc2l0aW9uTG9nAHRyYW5zaXRpb25EYXRlIjtPOjg6IkRhdGVUaW1lIjozOntzOjQ6ImRhdGUiO3M6MjY6IjIwMTgtMDUtMjUgMTc6MzY6MTMuMDI1NDAzIjtzOjEzOiJ0aW1lem9uZV90eXBlIjtpOjM7czo4OiJ0aW1lem9uZSI7czoxMzoiQXNpYS9TaGFuZ2hhaSI7fX1pOjE7Tzo0MDoiU3RhZ2VoYW5kXEZTTVxTdGF0ZU1hY2hpbmVcVHJhbnNpdGlvbkxvZyI6NDp7czo0NzoiAFN0YWdlaGFuZFxGU01cU3RhdGVNYWNoaW5lXFRyYW5zaXRpb25Mb2cAZXZlbnQiO3I6MTkzO3M6NTE6IgBTdGFnZWhhbmRcRlNNXFN0YXRlTWFjaGluZVxUcmFuc2l0aW9uTG9nAGZyb21TdGF0ZSI7cjoxODY7czo0OToiAFN0YWdlaGFuZFxGU01cU3RhdGVNYWNoaW5lXFRyYW5zaXRpb25Mb2cAdG9TdGF0ZSI7cjoxOTg7czo1NjoiAFN0YWdlaGFuZFxGU01cU3RhdGVNYWNoaW5lXFRyYW5zaXRpb25Mb2cAdHJhbnNpdGlvbkRhdGUiO086ODoiRGF0ZVRpbWUiOjM6e3M6NDoiZGF0ZSI7czoyNjoiMjAxOC0wNS0yNSAxNzozNjoxMy4wMjU0MDMiO3M6MTM6InRpbWV6b25lX3R5cGUiO2k6MztzOjg6InRpbWV6b25lIjtzOjEzOiJBc2lhL1NoYW5naGFpIjt9fWk6MjtPOjQwOiJTdGFnZWhhbmRcRlNNXFN0YXRlTWFjaGluZVxUcmFuc2l0aW9uTG9nIjo0OntzOjQ3OiIAU3RhZ2VoYW5kXEZTTVxTdGF0ZU1hY2hpbmVcVHJhbnNpdGlvbkxvZwBldmVudCI7cjoyMDU7czo1MToiAFN0YWdlaGFuZFxGU01cU3RhdGVNYWNoaW5lXFRyYW5zaXRpb25Mb2cAZnJvbVN0YXRlIjtyOjE5ODtzOjQ5OiIAU3RhZ2VoYW5kXEZTTVxTdGF0ZU1hY2hpbmVcVHJhbnNpdGlvbkxvZwB0b1N0YXRlIjtyOjI1ODtzOjU2OiIAU3RhZ2VoYW5kXEZTTVxTdGF0ZU1hY2hpbmVcVHJhbnNpdGlvbkxvZwB0cmFuc2l0aW9uRGF0ZSI7Tzo4OiJEYXRlVGltZSI6Mzp7czo0OiJkYXRlIjtzOjI2OiIyMDE4LTA1LTI1IDE3OjM2OjEzLjAyNTQwMyI7czoxMzoidGltZXpvbmVfdHlwZSI7aTozO3M6ODoidGltZXpvbmUiO3M6MTM6IkFzaWEvU2hhbmdoYWkiO319aTozO086NDA6IlN0YWdlaGFuZFxGU01cU3RhdGVNYWNoaW5lXFRyYW5zaXRpb25Mb2ciOjQ6e3M6NDc6IgBTdGFnZWhhbmRcRlNNXFN0YXRlTWFjaGluZVxUcmFuc2l0aW9uTG9nAGV2ZW50IjtyOjI3MDtzOjUxOiIAU3RhZ2VoYW5kXEZTTVxTdGF0ZU1hY2hpbmVcVHJhbnNpdGlvbkxvZwBmcm9tU3RhdGUiO3I6MjU4O3M6NDk6IgBTdGFnZWhhbmRcRlNNXFN0YXRlTWFjaGluZVxUcmFuc2l0aW9uTG9nAHRvU3RhdGUiO3I6MjM0O3M6NTY6IgBTdGFnZWhhbmRcRlNNXFN0YXRlTWFjaGluZVxUcmFuc2l0aW9uTG9nAHRyYW5zaXRpb25EYXRlIjtPOjg6IkRhdGVUaW1lIjozOntzOjQ6ImRhdGUiO3M6MjY6IjIwMTgtMDUtMjUgMTc6MzY6MTMuMDMwNDAzIjtzOjEzOiJ0aW1lem9uZV90eXBlIjtpOjM7czo4OiJ0aW1lem9uZSI7czoxMzoiQXNpYS9TaGFuZ2hhaSI7fX1pOjQ7Tzo0MDoiU3RhZ2VoYW5kXEZTTVxTdGF0ZU1hY2hpbmVcVHJhbnNpdGlvbkxvZyI6NDp7czo0NzoiAFN0YWdlaGFuZFxGU01cU3RhdGVNYWNoaW5lXFRyYW5zaXRpb25Mb2cAZXZlbnQiO3I6MjQxO3M6NTE6IgBTdGFnZWhhbmRcRlNNXFN0YXRlTWFjaGluZVxUcmFuc2l0aW9uTG9nAGZyb21TdGF0ZSI7cjoyMzQ7czo0OToiAFN0YWdlaGFuZFxGU01cU3RhdGVNYWNoaW5lXFRyYW5zaXRpb25Mb2cAdG9TdGF0ZSI7cjoyNTg7czo1NjoiAFN0YWdlaGFuZFxGU01cU3RhdGVNYWNoaW5lXFRyYW5zaXRpb25Mb2cAdHJhbnNpdGlvbkRhdGUiO086ODoiRGF0ZVRpbWUiOjM6e3M6NDoiZGF0ZSI7czoyNjoiMjAxOC0wNS0yNSAxNzozNjoxMy4wMzc0MDMiO3M6MTM6InRpbWV6b25lX3R5cGUiO2k6MztzOjg6InRpbWV6b25lIjtzOjEzOiJBc2lhL1NoYW5naGFpIjt9fWk6NTtPOjQwOiJTdGFnZWhhbmRcRlNNXFN0YXRlTWFjaGluZVxUcmFuc2l0aW9uTG9nIjo0OntzOjQ3OiIAU3RhZ2VoYW5kXEZTTVxTdGF0ZU1hY2hpbmVcVHJhbnNpdGlvbkxvZwBldmVudCI7cjoyNjU7czo1MToiAFN0YWdlaGFuZFxGU01cU3RhdGVNYWNoaW5lXFRyYW5zaXRpb25Mb2cAZnJvbVN0YXRlIjtyOjI1ODtzOjQ5OiIAU3RhZ2VoYW5kXEZTTVxTdGF0ZU1hY2hpbmVcVHJhbnNpdGlvbkxvZwB0b1N0YXRlIjtyOjIyMjtzOjU2OiIAU3RhZ2VoYW5kXEZTTVxTdGF0ZU1hY2hpbmVcVHJhbnNpdGlvbkxvZwB0cmFuc2l0aW9uRGF0ZSI7Tzo4OiJEYXRlVGltZSI6Mzp7czo0OiJkYXRlIjtzOjI2OiIyMDE4LTA1LTI1IDE3OjM2OjEzLjAzODQwMyI7czoxMzoidGltZXpvbmVfdHlwZSI7aTozO3M6ODoidGltZXpvbmUiO3M6MTM6IkFzaWEvU2hhbmdoYWkiO319fXM6NjoiYWN0aXZlIjtiOjE7czoxMzoidHJhbnNpdGlvbk1hcCI7YTo5OntzOjExOiJfX0lOSVRJQUxfXyI7YToxOntzOjk6Il9fU1RBUlRfXyI7cjoxODY7fXM6OToiX19TVEFSVF9fIjthOjE6e3M6NToic3RhcnQiO3I6MTk4O31zOjM6ImVuZCI7YToxOntzOjM6ImVuZCI7cjoxODU7fXM6NToic3RhcnQiO2E6MTp7czoyMjoicmFuZG9tX3p1bmRva29fZ2F0ZXdheSI7cjoyNTg7fXM6MTU6ImtpeW9zaGlfZ2F0ZXdheSI7YToyOntzOjIyOiJyYW5kb21fenVuZG9rb19nYXRld2F5IjtyOjI1ODtzOjExOiJzYXlfa2l5b3NoaSI7cjoyNDY7fXM6MjI6InJhbmRvbV96dW5kb2tvX2dhdGV3YXkiO2E6Mjp7czo4OiJzYXlfZG9rbyI7cjoyMjI7czo3OiJzYXlfenVuIjtyOjIzNDt9czo4OiJzYXlfZG9rbyI7YToxOntzOjE1OiJraXlvc2hpX2dhdGV3YXkiO3I6Mjc1O31zOjExOiJzYXlfa2l5b3NoaSI7YToxOntzOjM6ImVuZCI7cjoyMTA7fXM6Nzoic2F5X3p1biI7YToxOntzOjIyOiJyYW5kb21fenVuZG9rb19nYXRld2F5IjtyOjI1ODt9fX19fQ==';
//        $workflow = new Workflow(1,'test');
//        $workflow->unserialize(base64_decode($tess));
        $workflow->setProcessData(['record' => implode(',', $records), 'random' => 2]);
//        dd($workflow);
        $workflow->start(new StartEvent('start', $workflow->getRole('kiyoshi_hikawa')));
        $workflow->unserialize(($workflow->serialize()));
        while ($workflow->isActive()) {
            ddd($workflow);
//            ddd(,$workflow);//['stateMachine']->getTransitionLog()
//$dd=$workflow->getCurrentFlowObject();
            $participant = $workflow->getCurrentFlowObject()->getRole()->getId() == 'kiyoshi_hikawa' ? $kiyoshi : $fun;
            if (false !== strpos($workflow->getCurrentFlowObject()->getId(), 'say_')) {
                $record = str_replace('say_', '', $workflow->getCurrentFlowObject()->getId());
                $records[] = $record;
                var_dump($record);
            }
            $workflow->setProcessData(['record' => implode(',', $records), 'random' => 3]);
            $workflow->allocateWorkItem($workflow->getCurrentFlowObject(), $participant);
            $workflow->startWorkItem($workflow->getCurrentFlowObject(), $participant);
            $workflow->completeWorkItem($workflow->getCurrentFlowObject(), $participant);
        }

        return $records;
    }
}


class KiyoshiHikawa implements ParticipantInterface
{
    /**
     * @var ResourceInterface
     */
    private $resource;

    public function getId()
    {
        return 'mr_kiyoshi_hikawa';
    }

    public function hasRole($role)
    {
        return $role == 'kiyoshi_hikawa';
    }

    public function setResource(ResourceInterface $resource)
    {
        $this->resource = $resource;
    }

    public function getResource()
    {
        return $this->resource;
    }

    public function getName()
    {
        return $this->getId();
    }
}

class Fun implements ParticipantInterface
{
    /**
     * @var ResourceInterface
     */
    private $resource;
    private $id;

    public function __construct($id='just_a_fun')
    {
        $this->id = $id;
    }

    public function getId()
    {
        return $this->id;
    }

    public function hasRole($role)
    {
        return true;//$role == 'fun';
    }

    public function setResource(ResourceInterface $resource)
    {
        $this->resource = $resource;
    }

    public function getResource()
    {
        return $this->resource;
    }

    public function getName()
    {
        return $this->getId();
    }

}
